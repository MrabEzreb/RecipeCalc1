<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" id="viewport" content="width=device-width, initial-scale=1">
    <title>Calculator</title>

    <!-- Bootstrap -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="selectize.css" rel="stylesheet">
    <link href="selectize.bootstrap3.css" rel="stylesheet">

    <style>
        #container {
            text-align: center;
            max-height: 100%;
        }
        .divider {
            position: absolute;
            width: 0;
            height: calc(100% - 5.5em);
            border: 1px solid black;
            left: 50%;
        }
        .row {
            border-top: 2px solid black;
        }
    </style>
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
<!--    <div class="jumbotron">-->
    <div display="none">
        <item preset="All_Organic" crust="Homemade_Non-GMO" shortening="Butter" onion="" flour="Non-GMO" salt="Salt" pepper="Pepper" chickenbroth="Organic" milk="Organic" chicken="Organic_Whole" veggies="Mixed_Vegetables"></item>
        <item preset="Cheapest" crust="Premade" shortening="Margarine" onion="Whole" flour="GMO" salt="Salt" pepper="Pepper" chickenbroth="Non-Organic" milk="Non-Organic" chicken="Non-Organic_Whole" veggies="Mixed_Vegetables"></item>
        <item price=2.99 valueq="Premade" title="Crust"></item>
        <item price="5.98" valueq="Homemade" title="Crust"></item>
        <item price="10.98" valueq="Homemade_Non-GMO" title="Crust"></item>
        <item price=0.59 valueq="Butter" title="Shortening"></item>
        <item price=0.17 valueq="Margarine" title="Shortening"></item>
        <item price=1.03 valueq="Pre_Chopped" title="Onion"></item>
        <item price=0.77 valueq="Whole" title="Onion"></item>
        <item price=0.02 valueq="GMO" title="Flour"></item>
        <item price=0.07 valueq="Non-GMO" title="Flour"></item>
        <item price=0.01 valueq="Salt" title="Salt"></item>
        <item price=0.01 valueq="Pepper" title="Pepper"></item>
        <item price=1.36 valueq="Organic" title="Chicken Broth"></item>
        <item price=0.89 valueq="Non-Organic" title="Chicken Broth"></item>
        <item price=0.07 valueq="Non-Organic" title="Milk"></item>
        <item price=0.25 valueq="Organic" title="Milk"></item>
        <item price=10.18 valueq="Organic_Whole" title="Chicken"></item>
        <item price=29.14 valueq="Organic_Breast" title="Chicken"></item>
        <item price=17.49 valueq="Organic_Thigh" title="Chicken"></item>
        <item price=3.18 valueq="Non-Organic_Whole" title="Chicken"></item>
        <item price=6.68 valueq="Non-Organic_Breast" title="Chicken"></item>
        <item price=4.64 valueq="Non-Organic_Thigh" title="Chicken"></item>
        <item price=0.75 valueq="Mixed_Vegetables" title="Vegetables"></item>
    </div>
    <div id="container" class="container">
        <h1>Calculator</h1>
        <div class="row">
            <div class="col-xs-6">
                <p>Crust
                    <select class="choicedoptions" placeholder="Choose a preset or set options individually" name="crust" id="crust">
                        <option value=""></option>
                        <option price=2.99 value="Premade" id="Premade">Premade</option>
                        <option price="5.98" value="Homemade" id="Homemade">Homemade</option>
                        <option price="10.98" value="Homemade_Non-GMO" id="Homemade_(Non-GMO)">Non-GMO Homemade</option>
                    </select>
                </p>
                <p>Shortening
                    <select class="choicedoptions" placeholder="Choose a preset or set options individually" name="popcornsauce" id="popcornsauce" id="popcornsauce">
                        <option value=""></option>
                        <option price=0.59 value="Butter" id="Butter">Butter</option>
                        <option price=0.17 value="Margarine" id="Margarine">Margarine</option>
                    </select>
                </p>
                <p>Onion
                    <select class="choicedoptions" placeholder="Choose a preset or set options individually" name="onion" id="onion">
                        <option value=""></option>
                        <option price=1.03 value="Pre_Chopped" id="Pre_Chopped">1/3C Chopped Onion</option>
                        <option price=0.77 value="Whole" id="Whole">1lb Whole Onion</option>
                    </select>
                </p>
                <p>Flour
                    <select class="choicedoptions" placeholder="Choose a preset or set options individually" name="flour" id="flour">
                        <option value=""></option>
                        <option price=0.02 value="GMO" id="GMO">GMO</option>
                        <option price=0.07 value="Non-GMO" id="Non-GMO">Non-GMO</option>
                    </select>
                </p>
                <p>Salt
                    <select class="choicedoptions" placeholder="Choose a preset or set options individually" name="salt" id="salt">
                        <option value=""></option>
                        <option price=0.01 value="Salt" id="Salt">Salt</option>
                    </select>
                </p>
                <p>Pepper
                    <select class="choicedoptions" placeholder="Choose a preset or set options individually" name="pepper" id="pepper">
                        <option value=""></option>
                        <option price=0.01 value="Pepper" id="Pepper">Pepper</option>
                    </select>
                </p>
                <p>Chicken Broth
                    <select class="choicedoptions" placeholder="Choose a preset or set options individually" name="chickenbroth" id="chickenbroth">
                        <option value=""></option>
                        <option price=1.36 value="Organic" id="Organic">Organic</option>
                        <option price=0.89 value="Non-Organic" id="Non-Organic">Non-Organic</option>
                    </select>
                </p>
                <p>Milk
                    <select class="choicedoptions" placeholder="Choose a preset or set options individually" name="milk" id="milk">
                        <option value=""></option>
                        <option price=0.07 value="Non-Organic" id="Non-Organic">Non-Organic Milk</option>
                        <option price=0.25 value="Organic" id="Organic">Organic Milk</option>
                    </select>
                </p>
                <p>Chicken
                    <select class="choicedoptions" placeholder="Choose a preset or set options individually" name="chicken" id="chicken">
                        <option value=""></option>
                        <optgroup label="Organic">
                            <option price=10.18 value="Organic_Whole" id="Organic_Whole">Whole</option>
                            <option price=29.14 value="Organic_Breast" id="Organic_Breast">Breast Only</option>
                            <option price=17.49 value="Organic_Thigh" id="Organic_Thigh">Thigh Only</option>
                        </optgroup>
                        <optgroup label="Non-Organic">
                            <option price=3.18 value="Non-Organic_Whole" id="Non-Organic_Whole">Whole</option>
                            <option price=6.68 value="Non-Organic_Breast" id="Non-Organic_Breast">Breast Only</option>
                            <option price=4.64 value="Non-Organic_Thigh" id="Non-Organic_Thigh">Thigh Only</option>
                        </optgroup>
                    </select>
                </p>
                <p>Mized Vegetables
                    <select class="choicedoptions" placeholder="Choose a preset or set options individually" name="veggies" id="veggies">
                        <option value=""></option>
                        <option price=0.75 value="Mixed_Vegetables" id="Mixed_Vegetables">Mixed</option>
                    </select>
                </p>
            </div>
            <span class="divider"></span>
            <div class="col-xs-6">
                <h3>Presets
                    <select class="presetoptions" placeholder="Choose a preset" name="preset" id="preset">
                        <option value=""></option>
                        <option value="All Organic" id="All Organic">All Organic</option>
                        <option value="Cheapest" id="Cheapest">Cheapest</option>
                    </select>
                </h3>
                <a href="#" id="printbtn" onclick="prettyPrint();" class="btn btn-block btn-default">Print</a>
                <div class="container-fluid" style="text-align:center;">
                    <h1>Price</h1>
                    <h1 id="totalprice"></h1>
                </div>
            </div>
        </div>
    </div>
<!--    </div>-->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <script src="selectize.min.js"></script>
    <script>
        var selec = {}
        function getSelName(name) {
            return selec[name].selectize.items[0]
        }
        function getItemElem(name) {
            return $("[valueq="+ name +"]")
        }
        function getSelPrice(name) {
            return getItemElem(getSelName(name)).attr("price")
        }
        function p(name) {
            return parseFloat(getSelPrice(name))
        }
        function totalPrice() {
            return (p("crust") + p("popcornsauce") + p("onion") + p("flour") + p("salt") + p("pepper") + p("chickenbroth") + p("milk") + p("chicken") + p("veggies")).toFixed(2)
        }
        function done() {
            return selec.crust.selectize.items.length > 0 && selec.popcornsauce.selectize.items.length > 0 && selec.onion.selectize.items.length > 0 && selec.flour.selectize.items.length > 0 && selec.salt.selectize.items.length > 0 && selec.pepper.selectize.items.length > 0 && selec.chickenbroth.selectize.items.length > 0 && selec.milk.selectize.items.length > 0 && selec.chicken.selectize.items.length > 0 && selec.veggies.selectize.items.length > 0
        }
        function selectizer(eid) {
            var ret = $("#" + eid).selectize({
                sortField: 'text',
                plugins: ['optgroup_columns']
            })[0]
            ret.selectize.on('change', function() {
                if(done() == true) {
                    $("#totalprice").html("$" + totalPrice())
                } else {
                    $("#totalprice").html("Incomplete")
                }
            })
            return ret
        }
        var presetname = null;
        selec.crust = selectizer("crust");
        selec.popcornsauce = selectizer("popcornsauce");
        selec.onion = selectizer("onion");
        selec.flour = selectizer("flour");
        selec.salt = selectizer("salt");
        selec.pepper = selectizer("pepper");
        selec.chickenbroth = selectizer("chickenbroth");
        selec.milk = selectizer("milk");
        selec.chicken = selectizer("chicken");
        selec.veggies = selectizer("veggies");
        selec.preset = selectizer("preset");
        function setPreset(name) {
            presetname = name;
            if(name == null) {
                return;
            }
            var item = $("[preset=" + name.replace(" ", "_") + "]")
            selec.crust.selectize.removeItem(selec.crust.selectize.items[0])
            selec.crust.selectize.addItem(item.attr("crust"))
            selec.popcornsauce.selectize.removeItem(selec.popcornsauce.selectize.items[0])
            selec.popcornsauce.selectize.addItem(item.attr("shortening"))
            selec.onion.selectize.removeItem(selec.onion.selectize.items[0])
            selec.onion.selectize.addItem(item.attr("onion"))
            selec.flour.selectize.removeItem(selec.flour.selectize.items[0])
            selec.flour.selectize.addItem(item.attr("flour"))
            selec.salt.selectize.removeItem(selec.salt.selectize.items[0])
            selec.salt.selectize.addItem(item.attr("salt"))
            selec.pepper.selectize.removeItem(selec.pepper.selectize.items[0])
            selec.pepper.selectize.addItem(item.attr("pepper"))
            selec.chickenbroth.selectize.removeItem(selec.chickenbroth.selectize.items[0])
            selec.chickenbroth.selectize.addItem(item.attr("chickenbroth"))
            selec.milk.selectize.removeItem(selec.milk.selectize.items[0])
            selec.milk.selectize.addItem(item.attr("milk"))
            selec.chicken.selectize.removeItem(selec.chicken.selectize.items[0])
            selec.chicken.selectize.addItem(item.attr("chicken"))
            selec.veggies.selectize.removeItem(selec.veggies.selectize.items[0])
            selec.veggies.selectize.addItem(item.attr("veggies"))
//            selec.crust.selectize.refreshItems()
        }
        selec.preset.selectize.on('change', setPreset)
        function prettyPrint() {
            if(done() == false) {
                window.alert("Incomplete")
                /*$("#printbtn").html("Incomplete")
                setTimeout(function() {
                    $("#printbtn").html("Print")
                }, 2500)*/
                return
            }
            var w = window.open();
            function write(str) {
                w.document.write(str)
            }
            function getTitle(name) {
                return getItemElem(getSelName(name)).attr("title");
            }
            function writeItem(name) {
                write("<p>Price of " +getSelName(name).replace("_", " ")+ " (" + getTitle(name) + "): " + getSelPrice(name) + "</p>")
            }
            function i(name) {
                writeItem(name)
            }
            function allItems() {
                i("crust")
                i("popcornsauce")
                i("onion")
                i("flour")
                i("salt")
                i("pepper")
                i("chickenbroth")
                i("milk")
                i("chicken")
                i("veggies")
            }
            write("<body>")
            write("<h1 style=\"text-align: center;\">" + presetname + " Preset</h1>")
//            write(JSON.stringify(selec["crust"].selectize.getItem("Premade")))
//            write(getItemElem("Premade"))
//            write(getPrice(getSelName("crust")))
            allItems();
            write("<h1 style=\"text-align: center;\">Total Cost: " + totalPrice() + "</h1>")
            w.print()
            w.close()
        }
    </script>
</body>
</html>
